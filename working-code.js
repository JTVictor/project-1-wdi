$(document).ready(function(){

  const gridOver = [
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0]
  ];

  const gridPatterns = [
    [
      [1,1,1,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ], [
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,1,1,0,0],
      [0,0,0,0,0,0,0,1,0,0,0],
      [0,0,0,0,1,1,1,1,0,0,0],
      [0,0,0,0,1,0,0,1,0,0,0],
      [0,0,0,0,1,0,0,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ], [
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,1,1,0,0,0,1,1,0,0],
      [0,0,1,1,0,0,0,1,1,0,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,1,0,0,1,0,0,1,0,0],
      [0,0,1,0,0,0,0,0,1,0,0],
      [0,0,0,1,1,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ], [
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,0,0,1,1,1,0,0,0,0],
      [0,0,0,1,0,1,0,1,0,0,0],
      [0,0,1,0,0,1,0,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,1,1,1,1,1,1,1,1,1,0],
      [0,0,1,1,1,1,1,1,1,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ], [
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,1,0,0,0,1,0,0,0,1,0],
      [0,0,1,0,1,1,1,0,1,0,0],
      [0,0,0,1,0,0,0,1,0,0,0],
      [0,0,1,0,0,0,0,0,1,0,0],
      [1,1,1,0,0,0,0,0,1,1,1],
      [0,0,1,0,0,0,0,0,1,0,0],
      [0,0,0,1,0,0,0,1,0,0,0],
      [0,0,1,0,1,1,1,0,1,0,0],
      [0,1,0,0,0,1,0,0,0,1,0],
      [0,0,0,0,0,1,0,0,0,0,0]
    ], [
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0.0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,1,1,0,0,0],
      [0,0,0,0,0,0,0,1,1,0,0],
      [0,0,0,0,0,0,0,1,0,1,0],
      [0,0,0,0,0,0,0,1,0,1,0],
      [0,0,1,0,0,1,1,0,0,1,0],
      [0,0,1,1,1,0,0,0,1,0,0],
      [0,0,0,1,0,0,0,1,0,0,0],
      [0,0,0,0,1,1,1,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ], [
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,1,0,0,0,0,0,0],
      [0,0,0,1,1,1,1,1,0,0,0],
      [0,0,1,0,0,0,0,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,0],
      [0,1,0,0,0,0,0,0,0,1,0],
      [0,1,0,0,0,0,0,0,0,1,0],
      [0,1,0,0,1,1,1,0,0,1,0],
      [0,1,0,0,1,0,1,0,0,1,0],
      [0,1,1,1,1,1,1,1,1,1,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ], [
      [1,0,0,0,0,1,0,0,0,0,0],
      [1,1,0,0,1,1,0,0,0,0,0],
      [1,0,1,1,0,1,0,0,0,0,0],
      [1,0,0,0,0,1,0,0,0,0,0],
      [0,1,0,0,0,1,0,0,0,0,0],
      [0,0,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ],[
      [0,0,0,0,1,0,0,0,0,0,0],
      [0,0,0,1,0,1,0,0,0,0,0],
      [0,0,0,1,0,1,0,0,0,0,0],
      [0,0,0,1,0,1,0,0,0,0,0],
      [0,0,0,1,0,1,0,0,0,0,0],
      [0,0,0,1,0,1,0,0,0,0,0],
      [0,0,0,1,0,1,0,0,0,0,0],
      [0,0,0,1,0,1,0,0,0,0,0],
      [0,0,1,1,0,1,1,0,0,0,0],
      [0,0,1,0,0,0,1,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ],[
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,1,1,1,0,0],
      [0,0,0,0,0,0,1,1,1,1,1],
      [0,0,0,0,0,0,1,1,1,0,1],
      [0,0,0,0,0,0,1,1,1,1,1],
      [0,0,0,0,0,0,1,1,1,0,0]
    ],[
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,0,1,1,1,1,1,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,0,0,1,0,1,0,0,0,0],
      [0,0,0,1,0,0,0,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ],[
      [0,0,0,0,0,0,0,0,1,0,0],
      [0,0,0,0,0,0,0,0,1,0,0],
      [0,0,0,0,0,0,1,1,1,1,1],
      [0,0,0,0,0,0,0,0,1,0,0],
      [0,0,0,0,0,0,0,0,1,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ],[
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [1,1,1,1,1,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ],[
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,1,1,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0]
    ],[
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,1,0,0,0,1,0,0],
      [0,0,0,0,0,1,0,1,0,0,0],
      [0,0,0,0,0,0,1,0,0,0,0],
      [0,0,0,0,0,1,0,1,0,0,0],
      [0,0,0,0,1,0,0,0,1,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ],[
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,1,1,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,1,1,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0]
    ]
  ];

  const gridNames = ["Square", "Horse", "Face", "Boat", "Sun", "Moon", "House"];

  let gameCleared = false;
  let level = 0;
  let score = 5;


  $(()=>{

    const $scoreTable = $('#score');
    $scoreTable.text(score);

    // Iterates over the array and assigns a value. This also assigns a cell colour in CSS

    function createGrid() {
      $.each(gridOver, (i, row) => {
        $.each(row, (j, cell) => {
          const $myNewDiv = $('<div>');
          // make me switch
          if(cell === 0){
            $myNewDiv.addClass('over_blank')
          } else if (cell === 1) {
            $myNewDiv.addClass('over_success');
          } else if (cell === 2){
            $myNewDiv.addClass('over_fail');
          }

          // Creates a data object of the XY coordinates

          const myDataObject = {x: i, y: j};
          $myNewDiv.data(myDataObject); // set the data on myNewDiv
          $myNewDiv.appendTo('#over-grid');
          console.log(myDataObject);

          // Creates a function that identifies what cell has been clicked on

          $myNewDiv.on('click', function(){
            const clickedX = $(this).data('x');
            const clickedY = $(this).data('y');

            // Identifies what cell has been clicked on and changes it numerical value and colour
            // Can use switch on this code

            if(gridPatterns[level][clickedX][clickedY] === 1) {
              console.log('hit!');
              $myNewDiv.addClass('over_success');
              gridPatterns[level][clickedX][clickedY] = 0;
              score = score + 1;
              $scoreTable.text(score);
              // console.log(score);
            } else if (gridPatterns[level][clickedX][clickedY] === 0){
              // console.log('miss!');
              $myNewDiv.addClass('over_fail');
              score = score - 1;
              $scoreTable.text(score);
            }

            // if score < 0 {
            //   console.log(Dead);
            // }


            // Checks the win conditions on array and change colour.
            // This also advances the levels

            function checkWin(array) {
              const rowsValidity = [];
              for (var i = 0; i < array.length; i++) {
                rowsValidity[i] = array[i].includes(1);
              }
              gameCleared = rowsValidity.includes(true) ? false : true;
              console.log(gameCleared, level);
              console.log(gridNames)
            }
            checkWin(gridPatterns[level]);

            // Endgame function
            // This also appears essential for level progression. Work out why.

            function endLevel() {
              if(gameCleared) {
                console.log('You Win!');

                level++;
                score = score + 5;
                $scoreTable.text(score);
                console.log(level)

///////////////////////////////////////

                $('#over-grid').empty();
                createGrid();
                // createUnderGrid(level);
                gameCleared = false;
              }
            }
            endLevel();

          });
        });
      });
    }

    createGrid();
    // createUnderGrid(level);

  });

});
